!function(){var Tube={};Tube.req=new XMLHttpRequest;var data=[],getOptions=function(){var opt=[],i=0;if(localStorage.lines)for(opt=JSON.parse(localStorage.lines),i;13>i;i+=1)data[i]=1===opt[i]?!0:!1;else for(i;13>i;i+=1)data[i]=!0};Tube.requestFeed=function(){getOptions(),Tube.req.open("GET","http://cloud.tfl.gov.uk/TrackerNet/LineStatus",!0),Tube.req.onload=Tube.checkEvents,Tube.req.send(null)},Tube.checkEvents=function(){for(var items=Tube.req.responseXML.getElementsByTagName("LineStatus"),description="",minorDelays=0,busService=0,reducedService=0,severeDelays=0,partClosure=0,plannedClosure=0,partSuspended=0,suspended=0,specialService=0,partSuspendedLine="",suspendedLine="",severeDelaysLine="",minorDelaysLine="",specialServiceLine="",plannedClosureLine="",divider=" ",i=0,l=items.length;l>i;i+=1)data[i]&&(divider=" ",description=items[i].getElementsByTagName("Status")[0].getAttribute("Description"),"Suspended"===description?(suspended&&(divider=", "),suspended+=1,suspendedLine+=divider+items[i].getElementsByTagName("Line")[0].getAttribute("Name")+" Line"):"Part Suspended"===description?(partSuspended&&(divider=", "),partSuspended+=1,partSuspendedLine+=divider+items[i].getElementsByTagName("Line")[0].getAttribute("Name")+" Line"):"Planned Closure"===description||"Service Closed"===description?(plannedClosure&&(divider=", "),plannedClosure+=1,plannedClosureLine+=divider+items[i].getElementsByTagName("Line")[0].getAttribute("Name")+" Line"):"Part Closure"===description?partClosure+=1:"Severe Delays"===description?(severeDelays&&(divider=", "),severeDelays+=1,severeDelaysLine+=divider+items[i].getElementsByTagName("Line")[0].getAttribute("Name")+" Line"):"Special Service"===description?(specialService&&(divider=", "),specialService+=1,specialServiceLine+=divider+items[i].getElementsByTagName("Line")[0].getAttribute("Name")+" Line"):"Reduced Service"===description?reducedService+=1:"Bus Service"===description?busService+=1:"Minor Delays"===description&&(minorDelays&&(divider=", "),minorDelays+=1,minorDelaysLine+=divider+items[i].getElementsByTagName("Line")[0].getAttribute("Name")+" Line"));plannedClosure>0?(chrome.browserAction.setIcon({path:"images/bad.png"}),chrome.browserAction.setTitle({title:plannedClosureLine+" closed"})):suspended>0?(chrome.browserAction.setIcon({path:"images/bad.png"}),chrome.browserAction.setTitle({title:suspendedLine+" suspended"})):partSuspended>0?(chrome.browserAction.setIcon({path:"images/bad.png"}),chrome.browserAction.setTitle({title:partSuspendedLine+" part suspended"})):severeDelays>0?(chrome.browserAction.setIcon({path:"images/bad.png"}),chrome.browserAction.setTitle({title:severeDelaysLine+" severe delays"})):specialService>0?(chrome.browserAction.setIcon({path:"images/delay.png"}),chrome.browserAction.setTitle({title:specialServiceLine+" special service"})):minorDelays>0?(chrome.browserAction.setIcon({path:"images/delay.png"}),chrome.browserAction.setTitle({title:minorDelaysLine+" minor delays"})):(chrome.browserAction.setIcon({path:"images/good.png"}),chrome.browserAction.setTitle({title:"No issues reported"}))},Tube.init=setInterval(function(){Tube.requestFeed()},3e5),Tube.requestFeed()}();