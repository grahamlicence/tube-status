(function(){var e={};e.req=new XMLHttpRequest;var t=[];var n=function(){var e=[],n=0;if(localStorage.lines){e=JSON.parse(localStorage.lines);for(n;n<13;n+=1){t[n]=e[n]===1?true:false}}else{for(n;n<13;n+=1){t[n]=true}}};e.requestFeed=function(){n();e.req.open("GET","http://cloud.tfl.gov.uk/TrackerNet/LineStatus",true);e.req.onload=e.checkEvents;e.req.send(null)};e.checkEvents=function(){var n=e.req.responseXML.getElementsByTagName("LineStatus"),r="",i=0,s=0,o=0,u=0,a=0,f=0,l=0,c=0,h=0,p="",d="",v="",m="",g="",y="",b=" ";for(var w=0,E=n.length;w<E;w+=1){if(t[w]){b=" ";r=n[w].getElementsByTagName("Status")[0].getAttribute("Description");if(r==="Suspended"){if(c){b=", "}c+=1;d+=b+n[w].getElementsByTagName("Line")[0].getAttribute("Name")+" Line"}else if(r==="Part Suspended"){if(l){b=", "}l+=1;p+=b+n[w].getElementsByTagName("Line")[0].getAttribute("Name")+" Line"}else if(r==="Planned Closure"||r==="Service Closed"){if(f){b=", "}f+=1;y+=b+n[w].getElementsByTagName("Line")[0].getAttribute("Name")+" Line"}else if(r==="Part Closure"){a+=1}else if(r==="Severe Delays"){if(u){b=", "}u+=1;v+=b+n[w].getElementsByTagName("Line")[0].getAttribute("Name")+" Line"}else if(r==="Special Service"){if(h){b=", "}h+=1;g+=b+n[w].getElementsByTagName("Line")[0].getAttribute("Name")+" Line"}else if(r==="Reduced Service"){o+=1}else if(r==="Bus Service"){s+=1}else if(r==="Minor Delays"){if(i){b=", "}i+=1;m+=b+n[w].getElementsByTagName("Line")[0].getAttribute("Name")+" Line"}}}if(f>0){chrome.browserAction.setIcon({path:"images/bad.png"});chrome.browserAction.setTitle({title:y+" closed"})}else if(c>0){chrome.browserAction.setIcon({path:"images/bad.png"});chrome.browserAction.setTitle({title:d+" suspended"})}else if(l>0){chrome.browserAction.setIcon({path:"images/bad.png"});chrome.browserAction.setTitle({title:p+" part suspended"})}else if(u>0){chrome.browserAction.setIcon({path:"images/bad.png"});chrome.browserAction.setTitle({title:v+" severe delays"})}else if(h>0){chrome.browserAction.setIcon({path:"images/delay.png"});chrome.browserAction.setTitle({title:g+" special service"})}else if(i>0){chrome.browserAction.setIcon({path:"images/delay.png"});chrome.browserAction.setTitle({title:m+" minor delays"})}else{chrome.browserAction.setIcon({path:"images/good.png"});chrome.browserAction.setTitle({title:"No issues reported"})}};e.init=setInterval(function(){e.requestFeed()},3e5);e.requestFeed()})()